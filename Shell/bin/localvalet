#! /bin/bash

PROJECT_ROOT_DIR=`echo $PWD`
PUBLIC_DIR="$PROJECT_ROOT_DIR"/app/public/
COMPOSER_FILE="$PUBLIC_DIR"/composer.json
COMPOSER_LOCK="$PUBLIC_DIR"/composer.lock

GIT=`which git`
COMPOSER=`which composer`
VALET=`which valet`

if [ ! -f $COMPOSER_FILE ]; then
    exit "No composer.json found"
fi


cd $PUBLIC_DIR

echo "Setting up Wordpress..."

rm -rf ./*
rm -rf ./.*

# Clone Wordpress from git
$GIT clone git@github.com:WordPress/WordPress.git ./
rm -rf ./.git

cd ../../
$GIT reset --hard


cd app/public/

$COMPOSER clear-cache
$COMPOSER install

echo "Please fill in a test url for valet to link to this project"
read URL

$VALET link $url

read -p "Do you want to secure this url (https) [y/n]" -n 1 -r
echo    

if [[ $REPLY =~ ^[Yy]$ ]]
then
    $VALET secure
fi

